// ==UserScript==
// @name                BraveGPT 🤖
// @description         Adds ChatGPT answers to Brave Search sidebar (powered by GPT-4!)
// @description:af      Voeg ChatGPT-antwoorde by Brave Search-kantbalk by (aangedryf deur GPT-4!)
// @description:am      የChatGPT መልስናወርቃለች እርስዎን በBrave Search የተወሰኑ ገጽታዎችን (ተግባር በGPT-4!) ይጨምሩ
// @description:ar      يضيف إجابات ChatGPT إلى شريط البحث الجانبي في Brave (مدعوم بواسطة GPT-4!)
// @description:az      ChatGPT cavablarını Brave Axtarış yan panelinə əlavə edir (GPT-4 ilə gücləndirilmiş!)
// @description:be      Дадае адказы ChatGPT да бакавой баковай панэлі Brave Search (падтрымліваецца GPT-4!)
// @description:bem     Aziya ChatGPT ndalama ku Brave Search sidebar (muma GPT-4!)
// @description:bg      Добавя ChatGPT отговори към страничната лента на Brave Search (задвижван от GPT-4!)
// @description:bn      Brave সার্চ সাইডবারে ChatGPT উত্তর যোগ করে (পাওয়ারডে GPT-4 দ্বারা!)
// @description:bo      ChatGPT ལེ་བས་ཚད་བདག་སྐྱེད་དེ་བཟུམ་སྒྲིག་ནང་ Brave Search གནས་པ་བརྗོད་པ། (GPT-4བྱ་བ་བརྒྱུད་པ་!)
// @description:bs      Dodaje odgovore ChatGPT-a na bočnu traku Brave pretrage (pokreće GPT-4!)
// @description:ca      Afegeix respostes de ChatGPT a la barra lateral de Brave Search (amb tecnologia GPT-4!)
// @description:ceb     Nagdugang sa mga tubag sa ChatGPT sa sidebar sa Brave Search (gamit ang GPT-4!)
// @description:ckb     وەرگرتنی ڕاستەوخۆیی ChatGPT بۆ پەنجەرەی لاتی لە Brave (بە پشتگیرییی GPT-4!)
// @description:cs      Přidává odpovědi od ChatGPT do bočního panelu Brave Search (poháněno GPT-4!)
// @description:cy      Ychwanega Atebion ChatGPT i'r bar ochr Brave Search (a gryfhawyd gan GPT-4!)
// @description:da      Tilføjer ChatGPT-svar til Brave Search-sidelinjen (drevet af GPT-4!)
// @description:de      Fügt ChatGPT-Antworten zur Seitenleiste der Brave-Suche hinzu (betrieben mit GPT-4!)
// @description:dv      ChatGPT އައިކްސޭޓުގެ ޖަވާބުގެ Brave Search ސައިޓުގައި ފޯރުވާރައުގެ ޑައުން (އެކައުންއައި ވަކި GPT-4!)
// @description:dz      ChatGPT དང་ Brave འབྱུང་ཆུང་ལེ་བས་འཐུས་པ་ལགས་སྤྱོད་སྒྲིག་པ་བརྟགས་བཞུགས། (GPT-4་གི་སྒྲིག་དང་!)
// @description:el      Προσθέτει απαντήσεις ChatGPT στην πλαϊνή γραμμή αναζήτησης του Brave (με την υποστήριξη του GPT-4!)
// @description:eo      Aldonas ChatGPT-respondojn al la flanka breto de Brave Serĉo (funkciigita de GPT-4!)
// @description:es      Agrega respuestas de ChatGPT a la barra lateral de Brave Search (¡impulsado por GPT-4!)
// @description:et      Lisab ChatGPT vastused Brave Search küljepaneelile (toetatud GPT-4 poolt!)
// @description:eu      Gehitu ChatGPT erantzunak Brave Search aldeko alderakoan (GPT-4ren aurrerapenean oinarrituta!)
// @description:fa      ChatGPT پاسخها را به نوار کناری جستجوی Brave اضافه میکند (قدرت گرفته شده توسط GPT-4!)
// @description:fi      Lisää ChatGPT-vastaukset Brave-haun sivupalkkiin (käyttäen GPT-4!)
// @description:fo      Leggur ChatGPT-svar til Brave leitarstika síðupall (drivin av GPT-4!)
// @description:fr      Ajoute les réponses de ChatGPT à la barre latérale de Brave Search (propulsé par GPT-4 !)
// @description:fr-CA   Ajoute les réponses de ChatGPT à la barre latérale de Brave Search (propulsé par GPT-4 !)
// @description:gd      Cur Freagairtean ChatGPT ris an t-siostam-cùlaiche airson Innse Brave (le GPT-4 air!)
// @description:gl      Engade respostas de ChatGPT á barra lateral de busca de Brave (potenciado por GPT-4!)
// @description:gu      બ્રેવ શોધનપટનમાં ChatGPT જવાબો ઉમેરે છે (પાવર્ડપુંજ GPT-4 દ્વારા!)
// @description:haw     Hoʻoni i nā manaʻoʻiʻo ChatGPT i loko o ka papa kālai Brave Search (i hoʻohui ʻia e GPT-4!)
// @description:he      מוסיף תשובות של ChatGPT לסרגל הצד של חיפוש Brave (מופעל על ידי GPT-4!)
// @description:hi      ब्रेव सर्च साइडबार में ChatGPT उत्तर जोड़ता है (GPT-4 द्वारा संचालित!)
// @description:hr      Dodaje odgovore ChatGPT-a na bočnu traku Brave pretraživanja (pokreće GPT-4!)
// @description:ht      Ajoute ChatGPT repons nan sibbard Brave Search la (pouvwa pa GPT-4!)
// @description:hu      Hozzáadja a ChatGPT válaszokat a Brave Search oldalsávjához (GPT-4 által támogatva!)
// @description:hy      Ավելացնում է ChatGPT պատասխանները Brave Search կողմից (ուղղահայացված է GPT-4-ի միջոցով!)
// @description:id      Menambahkan jawaban ChatGPT ke sidebar Brave Search (didukung oleh GPT-4!)
// @description:is      Bætir við ChatGPT svari í hliðarstiku Brave leitarinnar (rekinn með GPT-4!)
// @description:it      Aggiunge le risposte di ChatGPT alla barra laterale di Brave Search (alimentato da GPT-4!)
// @description:ja      Brave 検索サイドバーに ChatGPT の回答を追加します（GPT-4 で動作中！）
// @description:jv      Nambahake jawaban ChatGPT menyang sidebar Pencarian Brave (didheteni GPT-4!)
// @description:ka      დაამატებს ChatGPT პასუხებს Brave Search გვერდის მარჯვნივ (GPT-4-ით გამოყენებული!)
// @description:kab     Izgan-d yemdanen n teblaḍ n Brave Search (ɣef GPT-4!)
// @description:kk      Brave іздеу жағдайындағы ChatGPT жауаптарын қосады (GPT-4-мен жұмыс істейді!)
// @description:km      បន្ថែមចម្លើយ ChatGPT ទៅរបារចំហៀងស្វែងរកក្លាហាន (ដំណើរការដោយ GPT-4!)
// @description:kn      ಬ್ರೇವ್ ಶೋಧನೆ ಪಟ್ಟಿಗೆ ChatGPT ಉತ್ತರಗಳನ್ನು ಸೇರಿಸುತ್ತದೆ (GPT-4 ಅನ್ನು ಬಳಸಿ!)
// @description:ko      ChatGPT 답변을 Brave 검색 사이드바에 추가합니다 (GPT-4로 구동됨!)
// @description:ku      Li ser panoya li serê lêgerîna Brave dihêle ChatGPT bersivan (bi alîkariya GPT-4!)
// @description:ky      ChatGPT каардарларын Браве Издөө экибинын көнчыгышына кошотот (GPT-4 менен күтөлгөн!)
// @description:la      Adiungit responsiones ChatGPT ad barra lateralem investigatiois Brave (GPT-4 motore!)
// @description:lb      Füügt ChatGPT Äntwerten zur Brave-Sichbarsäit bäi (gedriwwen vun GPT-4!)
// @description:lo      ຕອບສອນ ChatGPT ໄປຫາແຖບຂັ້ນຕອນຂອງການຄົ້ນຫາ Brave (ໂດຍໃຊ້ GPT-4!)
// @description:lt      Prideda ChatGPT atsakymus į šoninę juostą paieškai Brave (varomi GPT-4!)
// @description:lv      Pievieno ChatGPT atbildes Brave meklēšanas sānjoslai (darbināts ar GPT-4!)
// @description:mg      Mampiditra valiny avy amin'ny ChatGPT ao amin'ny saroka Search Brave (maneho ny GPT-4!)
// @description:mi      Tāpiri atu i ngā whakautu a ChatGPT ki te tara taha o te Rapu Wawata Brave (e whakahaerehia ana e GPT-4!)
// @description:mk      Додава одговори од ChatGPT на страничната лента на Brave Search (поддржано од GPT-4!)
// @description:ml      Brave സേർച്ചിന്റെ സൈഡ്ബാർലേക്ക് ChatGPT ഉത്തരങ്ങൾ ചേർക്കുന്നു (GPT-4-യിൽ പ്രവർത്തിക്കുന്നു!)
// @description:mn      ChatGPT хариултуудыг Brave Хайлтын зааврын зурагт нэмнэ (GPT-4 ашиглаж!)
// @description:ms      Menambah jawapan ChatGPT ke sidebar Carian Brave (dikuasakan oleh GPT-4!)
// @description:mt      Iżżid Risposti ta 'ChatGPT lill-Sidebar Brave Search (pwered by GPT-4!)
// @description:my      ChatGPT အဖြေမှာ Brave ရွေးချယ်ရေးတွင် ChatGPT အဖြေများကိုထည့်သွင်းထားသည် (GPT-4 ဖြင့်အလုပ်လုပ်ပါ!)
// @description:ne      ChatGPT उत्तरहरूलाई ब्रेभ खोजको साइडबारमा थप्छ (GPT-4 द्वारा संचालित!)
// @description:nl      Voegt ChatGPT-antwoorden toe aan de zijbalk van Brave Search (aangedreven door GPT-4!)
// @description:no      Legger til ChatGPT-svar i sidenotatfeltet for Brave Search (drevet av GPT-4!)
// @description:ny      Anayambitsa zambiri za ChatGPT kubanja lovala la Brave Search (liyenera ndi GPT-4!)
// @description:pa      ਬਰੇਵ ਖੋਜ ਦੇ ਸਾਈਡਬਾਰ ਵਿੱਚ ChatGPT ਜਵਾਬ ਸ਼ਾਮਲ ਕਰਦਾ ਹੈ (GPT-4 ਦੁਆਰਾ ਸ਼ਕਤੀਸ਼ਾਲਕ ਕੀਤਾ ਗਿਆ!)
// @description:pap     Añadi respuèstanan di ChatGPT na bar lateral di Buskeda Brave (poderá pa GPT-4!)
// @description:pl      Dodaje odpowiedzi ChatGPT do paska bocznego Brave Search (napędzane przez GPT-4!)
// @description:ps      په سپینې د Brave لټونکې توګه ChatGPT جوابونه ورکړي (د GPT-4 لخوا سره!)
// @description:pt      Adiciona respostas do ChatGPT à barra lateral de pesquisa do Brave (alimentado por GPT-4!)
// @description:pt-BR   Adiciona respostas do ChatGPT à barra lateral de pesquisa do Brave (alimentado por GPT-4!)
// @description:rn      Abugira inkomoko za ChatGPT mu gisubizo cya Brave Search (yahindutse na GPT-4!)
// @description:ro      Adaugă răspunsuri ChatGPT în bara laterală de căutare Brave (propulsat de GPT-4!)
// @description:ru      Добавляет ответы ChatGPT в боковую панель поиска Brave (работает на GPT-4!)
// @description:rw      Atera amakuru ya ChatGPT mu bariro bya Brave Search (yarahindutse n'ikoranabuhanga cya GPT-4!)
// @description:sg      Yãngã añ fããmi ChatGPT pũngu loo yaaka yi Brave tãngbala (saango wã yi GPT-4!)
// @description:si      ඔබේ Brave සෙවුම් පිළිතුරුද ChatGPT එක් කිරීමෙන් එක්වන්න (GPT-4 විද්‍යාවලියේ සිදු වේ!)
// @description:sk      Pridáva odpovede ChatGPT do bočnej lišty Brave Search (poháňané GPT-4!)
// @description:sl      Dodaja odgovore ChatGPT na stransko vrstico iskanja Brave (poganja GPT-4!)
// @description:sm      Fa'afaigofie atu ai le tali a ChatGPT i le sidebar o le Search Brave (e avea i le GPT-4!)
// @description:sn      Anoratidza zita reChatGPT pa sidebar yeBrave Search (ine vedzere GPT-4!)
// @description:so      Wax ka dar ChatGPT jawaabaha sidebar Brave Search (u shaqeeya GPT-4!)
// @description:sr      Додаје одговоре ChatGPT-а на страни панел претраге Брејва (покреће ГПТ-4!)
// @description:sv      Lägger till ChatGPT-svar i sidofältet för Brave Sökning (drivet av GPT-4!)
// @description:sw      Inaongeza majibu ya ChatGPT kwenye upau wa pembeni wa Brave Search (inaendeshwa na GPT-4!)
// @description:ta      பேராசை ஆய்வுக் கேட்பதற்கு ChatGPT பதில்களை Brave பக்க பக்கில் சேர்க்கிறது (GPT-4 ஆல் இயங்குகிறது!)
// @description:te      Brave శోధనపై ChatGPT సమాధానాలను జోడిస్తుంది (GPT-4 ద్వారా పెంచబడింది!)
// @description:tg      Шарҳи ChatGPT-ро ба сатҳи барои ҷустуҷӯи Брейв илова мекунад (тавассути GPT-4 мубодиъ будааст!)
// @description:th      เพิ่มคำตอบของ ChatGPT ไปยังแถบข้างของการค้นหา Brave (ทำงานโดย GPT-4!)
// @description:ti      ክልል ጸጋን ChatGPT መልእኽት ንምስርሓብ Brave ውልቀት ይጨምሩ (በቀረበ GPT-4!)
// @description:tk      ChatGPT-nyň jogaplaryny Brave Gözleg çarpyşysyna goşýar (GPT-4-dan güýçlenýär!)
// @description:tn      Enza mavoti ChatGPT ku sidebar yeBrave Search (ine yeduva neGPT-4!)
// @description:to      Tānaki e fiemaʻu ai ha ngaahi ngaue fakamatala 'a e ChatGPT ki he tu'unga ni ha Brave Search (na'e neongo'i moe GPT-4!)
// @description:tpi     Adim na pes bilong ChatGPT long tab bilong Brave Søk (wok long GPT-4!)
// @description:tr      ChatGPT yanıtlarını Brave Arama yan çubuğuna ekler (GPT-4 tarafından desteklenir!)
// @description:uk      Додає відповіді ChatGPT до бічної панелі пошуку Brave (працює на GPT-4!)
// @description:ur      ChatGPT جوابات کو بریو سرچ کے سائڈبار میں شامل کرتا ہے (GPT-4 کے ذریعے!)
// @description:uz      ChatGPT javoblarni Brave Qidiruvning yon paneliga qo'shadi (GPT-4 tomonidan ta'minlanadi!)
// @description:vi      Thêm câu trả lời của ChatGPT vào thanh bên của Brave Search (được cung cấp bởi GPT-4!)
// @description:xh      Enza amaxwebhu kaChatGPT e sideba yeBrave Search (enokukhuthaziswa nguGPT-4!)
// @description:yi      צוגעבן אַנטוואָרטן פֿון ChatGPT אין די זײַטל-פֿעלד פֿון Brave זוך (געפּאַווערטעד דורך GPT-4!)
// @description:zh      将 ChatGPT 答案添加到 Brave Search 侧边栏 (由 GPT-4 提供支持!)
// @description:zh-CN   将 ChatGPT 答案添加到 Brave Search 侧边栏 (由 GPT-4 提供支持!)
// @description:zh-HK   將 ChatGPT 答案添加到 Brave Search 側邊欄 (由 GPT-4 提供支持!)
// @description:zh-SG   将 ChatGPT 答案添加到 Brave Search 侧边栏 (由 GPT-4 提供支持!)
// @description:zh-TW   將 ChatGPT 答案添加到 Brave Search 側邊欄 (由 GPT-4 提供支持!)
// @description:zu      Engeza amaswazi aseChatGPT emugqa wokuqala weBrave Search (ibhulohwe nguGPT-4!)
// @author              KudoAI
// @namespace           https://kudoai.com
// @version             2024.4.12
// @license             MIT
// @icon                https://media.bravegpt.com/images/icons/bravegpt/icon48.png
// @icon64              https://media.bravegpt.com/images/icons/bravegpt/icon64.png
// @compatible          chrome
// @compatible          firefox
// @compatible          edge
// @compatible          opera
// @compatible          brave
// @compatible          vivaldi
// @compatible          waterfox
// @compatible          librewolf
// @compatible          ghost
// @compatible          qq
// @compatible          whale
// @compatible          kiwi
// @match               *://search.brave.com/search*
// @include             https://auth0.openai.com
// @connect             raw.githubusercontent.com
// @connect             greasyfork.org
// @connect             chat.openai.com
// @connect             api.openai.com
// @connect             fanyi.sogou.com
// @connect             api.aigcfun.com
// @require             https://cdn.jsdelivr.net/npm/@kudoai/chatgpt.js@2.6.8/dist/chatgpt.min.js#sha256-veeaKpmLF7CZ6kxNfn8SMjD36ijLffGCzel9G4ykpPI=
// @require             https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.js#sha256-n0UwfFeU7SR6DQlfOmLlLvIhWmeyMnIDp/2RmVmuedE=
// @require             https://cdn.jsdelivr.net/npm/katex@0.16.7/dist/contrib/auto-render.min.js#sha256-nLjaz8CGwpZsnsS6VPSi3EO3y+KzPOwaJ0PYhsf7R6c=
// @require             https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js#sha256-jjsBF/TfS+RSwLavW48KCs+dSt4j0I1V1+MSryIHd2I=
// @require             https://cdn.jsdelivr.net/npm/generate-ip@2.2.4/dist/generate-ip.min.js#sha256-FJO9oo6Fpy0nY5ak5NWIEg8BtX+As53nDJEYrODHRPM=
// @grant               GM_getValue
// @grant               GM_setValue
// @grant               GM_deleteValue
// @grant               GM_cookie
// @grant               GM_registerMenuCommand
// @grant               GM_unregisterMenuCommand
// @grant               GM_openInTab
// @grant               GM.xmlHttpRequest
// @downloadURL         https://update.greasyfork.org/scripts/462440/bravegpt.user.js
// @updateURL           https://update.greasyfork.org/scripts/462440/bravegpt.meta.js
// @homepageURL         https://www.bravegpt.com
// @supportURL          https://github.bravegpt.com/issues
// ==/UserScript==

// NOTE: This script relies on the powerful chatgpt.js library @ https://chatgpt.js.org © 2023–2024 KudoAI & contributors under the MIT license
// ...and KaTeX, the fastest math typesetting library @ https://katex.org © 2013–2020 Khan Academy & contributors under the MIT license

(async () => {

    // Define SCRIPT functions

    function loadSetting(...keys) { keys.forEach(key => config[key] = GM_getValue(config.keyPrefix + '_' + key, false)) }
    function saveSetting(key, value) { GM_setValue(config.keyPrefix + '_' + key, value) ; config[key] = value }
    function safeWindowOpen(url) { window.open(url, '_blank', 'noopener') } // to prevent backdoor vulnerabilities
    function getUserscriptManager() { try { return GM_info.scriptHandler } catch (err) { return 'other' }}

    // Define MENU functions

    function registerMenu() {

        // Add command to toggle proxy API mode
        const pamLabel = state.symbol[+!config.proxyAPIenabled] + ' '
                       + ( messages.menuLabel_proxyAPImode || 'Proxy API Mode' ) + ' '
                       + state.separator + state.word[+!config.proxyAPIenabled]
        menuIDs.push(GM_registerMenuCommand(pamLabel, () => {
            saveSetting('proxyAPIenabled', !config.proxyAPIenabled)
            notify(( messages.menuLabel_proxyAPImode || 'Proxy API Mode' ) + ' ' + state.word[+!config.proxyAPIenabled])
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
            location.reload() // re-send query using new endpoint
        }))

        // Add command to toggle auto-get mode
        const agmLabel = state.symbol[+config.autoGetDisabled] + ' '
                       + ( messages.menuLabel_autoGetAnswers || 'Auto-Get Answers' ) + ' '
                       + state.separator + state.word[+config.autoGetDisabled]
        menuIDs.push(GM_registerMenuCommand(agmLabel, () => {
            saveSetting('autoGetDisabled', !config.autoGetDisabled)
            notify(( messages.menuLabel_autoGetAnswers || 'Auto-Get Answers' ) + ' ' + state.word[+config.autoGetDisabled])
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
        }))

        // Add command to toggle showing related queries
        const rqLabel = state.symbol[+config.rqDisabled] + ' '
                      + ( messages.menuLabel_relatedQueries || 'Related Queries' ) + ' '
                      + state.separator + state.word[+config.rqDisabled]
        menuIDs.push(GM_registerMenuCommand(rqLabel, () => {
            saveSetting('rqDisabled', !config.rqDisabled)
            try { // to update visibility based on latest setting
                const relatedQueriesDiv = document.querySelector('.related-queries')
                relatedQueriesDiv.style.display = config.rqDisabled ? 'none' : 'flex'
            } catch (err) {}
            updateTweaksStyle() // toggle <pre> max-height
            notify(( messages.menuLabel_relatedQueries || 'Related Queries' ) + ' '
                + state.word[+config.rqDisabled])
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
        }))

        // Add command to toggle prefix mode
        const pmLabel = state.symbol[+!config.prefixEnabled] + ' '
                      + ( messages.menuLabel_require || 'Require' ) + ' "/" '
                      + ( messages.menuLabel_beforeQuery || 'before query' ) + ' '
                      + state.separator + state.word[+!config.prefixEnabled]
        menuIDs.push(GM_registerMenuCommand(pmLabel, () => {
            saveSetting('prefixEnabled', !config.prefixEnabled)
            if (config.prefixEnabled && config.suffixEnabled) { // disable Suffix Mode if activating Prefix Mode
                saveSetting('suffixEnabled', !config.suffixEnabled) }
            notify(( messages.mode_prefix || 'Prefix Mode' ) + ' ' + state.word[+!config.prefixEnabled])
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
        }))

        // Add command to toggle suffix mode
        const smLabel = state.symbol[+!config.suffixEnabled] + ' '
                      + ( messages.menuLabel_require || 'Require' ) + ' "?" '
                      + ( messages.menuLabel_afterQuery || 'after query' ) + ' '
                      + state.separator + state.word[+!config.suffixEnabled]
        menuIDs.push(GM_registerMenuCommand(smLabel, () => {
            saveSetting('suffixEnabled', !config.suffixEnabled)
            if (config.prefixEnabled && config.suffixEnabled) { // disable Prefix Mode if activating Suffix Mode
                saveSetting('prefixEnabled', !config.prefixEnabled) }
            notify(( messages.mode_suffix || 'Suffix Mode' ) + ' ' + state.word[+!config.suffixEnabled])
            for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
        }))

        if (!isMobile) {

            // Add command to toggle wider sidebar
            const wsbLabel = state.symbol[+!config.widerSidebar] + ' '
                           + ( messages.menuLabel_widerSidebar || 'Wider Sidebar' )
                           + state.separator + state.word[+!config.widerSidebar]
            menuIDs.push(GM_registerMenuCommand(wsbLabel, () => toggleSidebar('wider')))

            // Add command to toggle sticky sidebar
            const ssbLabel = state.symbol[+!config.stickySidebar] + ' '
                           + ( messages.menuLabel_stickySidebar || 'Sticky Sidebar' )
                           + state.separator + state.word[+!config.stickySidebar]
            menuIDs.push(GM_registerMenuCommand(ssbLabel, () => toggleSidebar('sticky')))
        }

        // Add command to set reply language
        const rlLabel = '🌐 ' + ( messages.menuLabel_replyLanguage || 'Reply Language' )
                      + state.separator + config.replyLanguage
        menuIDs.push(GM_registerMenuCommand(rlLabel, () => {
            while (true) {
                let replyLanguage = prompt(
                    ( messages.prompt_updateReplyLang || 'Update reply language' ) + ':', config.replyLanguage)
                if (replyLanguage === null) break // user cancelled so do nothing
                else if (!/\d/.test(replyLanguage)) {
                    replyLanguage = ( // auto-case for menu/alert aesthetics
                        [2, 3].includes(replyLanguage.length) || replyLanguage.includes('-') ? replyLanguage.toUpperCase()
                          : replyLanguage.charAt(0).toUpperCase() + replyLanguage.slice(1).toLowerCase() )
                    saveSetting('replyLanguage', replyLanguage || config.userLanguage)
                    alert(( messages.alert_langUpdated || 'Language updated' ) + '!', // title
                        `${ config.appName } ${ messages.alert_willReplyIn || 'will reply in' } `
                            + ( replyLanguage || messages.alert_yourSysLang || 'your system language' ) + '.')
                    for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
                    break
        }}}))

        // Add command to launch About modal
        const aboutLabel = `💡 ${ messages.menuLabel_about || 'About' } ${ config.appName }`
        menuIDs.push(GM_registerMenuCommand(aboutLabel, launchAboutModal))
    }

    function launchAboutModal() {

        // Show modal
        const chatgptJSver = (/chatgpt-([\d.]+)\.min/.exec(GM_info.script.header) || [null, ''])[1]
        const aboutAlertID = alert(
            config.appName, // title
            '🏷️ ' + ( messages.about_version || 'Version' ) + ': ' + GM_info.script.version + '\n'
                + '⚡ ' + ( messages.about_poweredBy || 'Powered by' ) + ': '
                    + '<a href="https://chatgpt.js.org" target="_blank" rel="noopener">chatgpt.js</a>'
                    + ( chatgptJSver ? ( ' v' + chatgptJSver ) : '' ) + '\n'
                + '📜 ' + ( messages.about_sourceCode || 'Source code' ) + ':\n '
                    + `<a href="${ config.gitHubURL }" target="_blank" rel="nopener">`
                        + config.gitHubURL + '</a>',
            [ // buttons
                function checkForUpdates() { updateCheck() },
                function getSupport() { safeWindowOpen(config.supportURL) },
                function leaveAReview() {
                    const reviewAlertID = chatgpt.alert(( messages.alert_choosePlatform || 'Choose a platform' ) + ':', '',
                        [ function greasyFork() { safeWindowOpen(
                              config.greasyForkURL + '/feedback#post-discussion') },
                          function productHunt() { safeWindowOpen(
                              'https://www.producthunt.com/products/bravegpt/reviews/new') },
                          function futurepedia() { safeWindowOpen(
                              'https://www.futurepedia.io/tool/bravegpt#bravegpt-review') },
                          function alternativeTo() { safeWindowOpen(
                              'https://alternativeto.net/software/bravegpt/about/') }],
                        '', 571) // Review modal width
                    const reviewBtns = document.getElementById(reviewAlertID).querySelectorAll('button')
                    reviewBtns[0].style.display = 'none' // hide dismiss button
                    reviewBtns[1].textContent = ( // remove spaces from AlternativeTo label
                        reviewBtns[1].textContent.replace(/\s/g, '')) },
                function moreChatGPTapps() { safeWindowOpen('https://github.com/adamlui/chatgpt-apps') }
            ], '', 577) // About modal width

        // Re-format buttons to include emoji + localized label + hide Dismiss button
        for (const button of document.getElementById(aboutAlertID).querySelectorAll('button')) {
            if (/updates/i.test(button.textContent)) button.textContent = (
                '🚀 ' + ( messages.buttonLabel_updateCheck || 'Check for Updates' ))
            else if (/support/i.test(button.textContent)) button.textContent = (
                '🧠 ' + ( messages.buttonLabel_getSupport || 'Get Support' ))
            else if (/review/i.test(button.textContent)) button.textContent = (
                '⭐ ' + ( messages.buttonLabel_leaveReview || 'Leave a Review' ))
            else if (/apps/i.test(button.textContent)) button.textContent = (
                '🤖 ' + ( messages.buttonLabel_moreApps || 'More ChatGPT Apps' ))
            else button.style.display = 'none' // hide Dismiss button
        }
    }

    function updateCheck() {

        // Fetch latest meta
        const currentVer = GM_info.script.version
        GM.xmlHttpRequest({
            method: 'GET', url: config.updateURL + '?t=' + Date.now(),
            headers: { 'Cache-Control': 'no-cache' },
            onload: response => { const updateAlertWidth = 489

                // Compare versions
                const latestVer = /@version +(.*)/.exec(response.responseText)[1]
                for (let i = 0 ; i < 4 ; i++) { // loop thru subver's
                    const currentSubVer = parseInt(currentVer.split('.')[i], 10) || 0,
                          latestSubVer = parseInt(latestVer.split('.')[i], 10) || 0
                    if (currentSubVer > latestSubVer) break // out of comparison since not outdated
                    else if (latestSubVer > currentSubVer) { // if outdated

                        // Alert to update
                        const updateAlertID = alert(( messages.alert_updateAvail || 'Update available' ) + '! 🚀', // title
                            `${ messages.alert_newerVer || 'An update to' } ${ config.appName } `
                                + `(v${ latestVer }) ${ messages.alert_isAvail || 'is available' }!  `
                                + '<a target="_blank" rel="noopener" style="font-size: 0.93rem" '
                                    + 'href="' + config.gitHubURL + '/commits/main/greasemonkey/'
                                    + config.updateURL.replace(/.*\/(.*)meta\.js/, '$1user.js') + '"  '
                                    + `>${ messages.link_viewChanges || 'View changes' }</a>`,
                            function update() { // button
                                GM_openInTab(config.updateURL.replace('meta.js', 'user.js') + '?t=' + Date.now(),
                                    { active: true, insert: true } // focus, make adjacent
                                ).onclose = () => location.reload() },
                            '', updateAlertWidth
                        )

                        // Localize button labels if needed
                        if (!config.userLanguage.startsWith('en')) {
                            const updateAlert = document.querySelector(`[id="${ updateAlertID }"]`),
                                  updateBtns = updateAlert.querySelectorAll('button')
                            updateBtns[1].textContent = messages.buttonLabel_update || 'Update'
                            updateBtns[0].textContent = messages.buttonLabel_dismiss || 'Dismiss'
                        }

                        return
                }}

                // Alert to no update found, nav back
                alert(( messages.alert_upToDate || 'Up-to-date' ) + '!', // title
                    `${ config.appName } (v${ currentVer }) ${ messages.alert_isUpToDate || 'is up-to-date' }!`, // msg
                        '', '', updateAlertWidth)
                launchAboutModal()
    }})}

    // Define FEEDBACK functions

    function notify(msg, position = '', notifDuration = '', shadow = '') {
        chatgpt.notify(`${ config.appSymbol } ${ msg }`, position, notifDuration,
            shadow || scheme == 'dark' ? '' : 'shadow' )
    }

    function alert(title = '', msg = '', btns = '', checkbox = '', width = '') {
        return chatgpt.alert(`${ config.appSymbol } ${ title }`, msg, btns, checkbox, width)}

    function appAlert(msg) {
        msg = appAlerts[msg] || msg
        if (msg.includes('login')) deleteOpenAIcookies()
        while (appDiv.firstChild) { appDiv.removeChild(appDiv.firstChild) }
        const alertP = document.createElement('p') ; alertP.textContent = msg
        alertP.className = 'no-user-select' ; alertP.style.marginBottom = '-15px'
        if (/waiting|loading/i.test(msg)) alertP.classList.add('loading')
        if (msg.includes('@')) { // needs login link, add it
            alertP.append(createAnchor('https://chat.openai.com', 'chat.openai.com'),
                ' (', messages.alert_ifIssuePersists || 'If issue persists, try activating Proxy Mode', ')')
        }
        appDiv.append(alertP)
    }

    function appInfo(msg) { console.info(`${ config.appSymbol } ${ config.appName } >> ${ msg }`) }
    function appError(msg) { console.error(`${ config.appSymbol } ${ config.appName } >> ERROR: ${ msg }`) }

    // Define UI functions

    function isDarkMode() {
        return document.documentElement.classList.contains('dark') ? true
             : document.documentElement.classList.contains('light') ? false
             : window.matchMedia?.('(prefers-color-scheme: dark)')?.matches
    }

    function toggleSidebar(mode) {
        saveSetting(mode + 'Sidebar', !config[mode + 'Sidebar'])
        updateTweaksStyle()
        if (mode == 'wider' && document.querySelector('.corner-btn')) updateWSBsvg() ; else updateSSBsvg()
        notify(( messages[`menuLabel_${ mode }Sidebar`] || mode.charAt(0).toUpperCase() + mode.slice(1) + ' Sidebar' )
            + ' ' + state.word[+!config[mode + 'Sidebar']])
        for (const id of menuIDs) { GM_unregisterMenuCommand(id) } registerMenu() // refresh menu
    }

    function updateTweaksStyle() {
        const isStandbyMode = document.querySelector('.standby-btn'),
              answerIsLoaded = document.querySelector('.corner-btn')

        // Update tweaks style based on settings (for tweaks init + appShow() + toggleSidebar())
        tweaksStyle.innerText = ( config.widerSidebar ? wsbStyles : '' )
                              + ( config.stickySidebar && !isStandbyMode && answerIsLoaded ? ssbStyles : '' )

        // Update <pre> max-height in Sticky Sidebar mode based on RQ visibility (for getShowReply()'s RQ show + menu RQ toggle)
        const answerPre = document.querySelector('.bravegpt pre'),
              relatedQueries = document.querySelector('.related-queries'),
              shorterPreHeight = window.innerHeight - relatedQueries?.offsetHeight - 226,
              longerPreHeight = window.innerHeight - 200
        if (answerPre) answerPre.style.maxHeight = !config.stickySidebar ? 'none' : (
            relatedQueries?.offsetHeight > 0 ? `${ shorterPreHeight }px` : `${ longerPreHeight }px` )
    }

    function updateWSBsvg() {

        // Init span/SVG/paths
        const wsbSpan = appDiv.querySelector('#wsb-btn'),
              wsbSVG = wsbSpan.querySelector('svg')
        const wsbONpaths = [
            createSVGpath({ fill: '', 'fill-rule': 'evenodd',
                d: 'm26,13 0,10 -16,0 0,-10 z m-14,2 12,0 0,6 -12,0 0,-6 z' }) ]
        const wsbOFFpaths = [
            createSVGpath({ fill: '', 'fill-rule': 'evenodd',
                d: 'm28,11 0,14 -20,0 0,-14 z m-18,2 16,0 0,10 -16,0 0,-10 z' }) ]

        // Set SVG attributes
        for (const [attr, value] of [['width', 18], ['height', 18], ['viewBox', '8 8 20 20']])
            wsbSVG.setAttribute(attr, value)

        // Update SVG elements
        while (wsbSVG.firstChild) { wsbSVG.removeChild(wsbSVG.firstChild) }
        const wsbSVGpaths = config.widerSidebar ? wsbONpaths : wsbOFFpaths
        wsbSVGpaths.forEach(path => wsbSVG.append(path))
        if (!wsbSpan.contains(wsbSVG)) wsbSpan.append(wsbSVG)
    }

    function updateSSBsvg() {

        // Init span/SVG/paths
        const ssbSpan = appDiv.querySelector('#ssb-btn'),
              ssbSVG = ssbSpan.querySelector('svg')
        const ssbONpaths = [
            createSVGpath({
                d: 'M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707-.195-.195.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146z' }) ]
        const ssbOFFpaths = [
            createSVGpath({
                d: 'M9.828.722a.5.5 0 0 1 .354.146l4.95 4.95a.5.5 0 0 1 0 .707c-.48.48-1.072.588-1.503.588-.177 0-.335-.018-.46-.039l-3.134 3.134a5.927 5.927 0 0 1 .16 1.013c.046.702-.032 1.687-.72 2.375a.5.5 0 0 1-.707 0l-2.829-2.828-3.182 3.182c-.195.195-1.219.902-1.414.707-.195-.195.512-1.22.707-1.414l3.182-3.182-2.828-2.829a.5.5 0 0 1 0-.707c.688-.688 1.673-.767 2.375-.72a5.922 5.922 0 0 1 1.013.16l3.134-3.133a2.772 2.772 0 0 1-.04-.461c0-.43.108-1.022.589-1.503a.5.5 0 0 1 .353-.146zm.122 2.112v-.002.002zm0-.002v.002a.5.5 0 0 1-.122.51L6.293 6.878a.5.5 0 0 1-.511.12H5.78l-.014-.004a4.507 4.507 0 0 0-.288-.076 4.922 4.922 0 0 0-.765-.116c-.422-.028-.836.008-1.175.15l5.51 5.509c.141-.34.177-.753.149-1.175a4.924 4.924 0 0 0-.192-1.054l-.004-.013v-.001a.5.5 0 0 1 .12-.512l3.536-3.535a.5.5 0 0 1 .532-.115l.096.022c.087.017.208.034.344.034.114 0 .23-.011.343-.04L9.927 2.028c-.029.113-.04.23-.04.343a1.779 1.779 0 0 0 .062.46z' }) ]

        // Set SVG attributes
        for (const [attr, value] of [['width', 16], ['height', 16], ['viewBox', '0 0 16 16']])
            ssbSVG.setAttribute(attr, value)

        // Update SVG elements
        while (ssbSVG.firstChild) { ssbSVG.removeChild(ssbSVG.firstChild) }
        const ssbSVGpaths = config.stickySidebar ? ssbONpaths : ssbOFFpaths
        ssbSVGpaths.forEach(path => ssbSVG.append(path))
        if (!ssbSpan.contains(ssbSVG)) ssbSpan.append(ssbSVG)
    }

    function updateFooterContent() {
        fetchJSON('https://raw.githubusercontent.com/KudoAI/ads-library/main/advertisers/index.json',
            (err, advertisersData) => { if (err) return

                // Init vars
                let chosenAdvertiser, adSelected
                const re_appName = new RegExp(config.appName.toLowerCase(), 'i')
                const currentDate = (() => { // in YYYYMMDD format
                    const today = new Date(), year = today.getFullYear(),
                          month = String(today.getMonth() + 1).padStart(2, '0'),
                          day = String(today.getDate()).padStart(2, '0')
                    return year + month + day
                })()

                // Select random, active advertiser
                for (const [advertiser, details] of shuffle(applyBoosts(Object.entries(advertisersData))))
                    if (details.campaigns.text) { chosenAdvertiser = advertiser ; break }

                // Fetch a random, active creative
                if (chosenAdvertiser) {
                    const campaignsURL = 'https://raw.githubusercontent.com/KudoAI/ads-library/main/advertisers/'
                                       + chosenAdvertiser + '/text/campaigns.json'
                    fetchJSON(campaignsURL, (err, campaignsData) => { if (err) return

                        // Select random, active campaign
                        for (const [campaignName, campaign] of shuffle(applyBoosts(Object.entries(campaignsData)))) {
                            const campaignIsActive = campaign.active && (!campaign.endDate || currentDate <= campaign.endDate)
                            if (!campaignIsActive) continue // to next campaign since campaign inactive

                            // Select random active group
                            for (const [groupName, adGroup] of shuffle(applyBoosts(Object.entries(campaign.adGroups)))) {

                                // Skip disqualified groups
                                if (/^self$/i.test(groupName) && !re_appName.test(campaignName) // self-group for other apps
                                    || re_appName.test(campaignName) && !/^self$/i.test(groupName) // non-self group for this app
                                    || adGroup.active === false // group explicitly disabled
                                    || adGroup.targetBrowsers && // target browser(s) exist...
                                        !adGroup.targetBrowsers.some( // ...but doesn't match user's
                                            browser => new RegExp(browser, 'i').test(navigator.userAgent))
                                    || adGroup.targetLocations && ( // target locale(s) exist...
                                        !config.userLocale || !adGroup.targetLocations.some( // ...but user locale is missing or excluded
                                            loc => loc.includes(config.userLocale) || config.userLocale.includes(loc)))
                                ) continue // to next group

                                // Filter out inactive ads, pick random active one
                                const activeAds = adGroup.ads.filter(ad => ad.active !== false)
                                if (activeAds.length === 0) continue // to next group since no ads active
                                const chosenAd = activeAds[Math.floor(Math.random() * activeAds.length)] // random active one

                                // Build destination URL
                                let destinationURL = chosenAd.destinationURL || adGroup.destinationURL
                                    || campaign.destinationURL || ''
                                if (destinationURL.includes('http')) { // insert UTM tags
                                    const [baseURL, queryString] = destinationURL.split('?'),
                                          queryParams = new URLSearchParams(queryString || '')
                                    queryParams.set('utm_source', config.appName.toLowerCase())
                                    queryParams.set('utm_content', 'app_footer_link')
                                    destinationURL = baseURL + '?' + queryParams.toString()
                                }

                                // Update footer content
                                const newFooterContent = destinationURL ? createAnchor(destinationURL)
                                                                        : document.createElement('span')
                                footerContent.replaceWith(newFooterContent) ; footerContent = newFooterContent
                                footerContent.classList.add('feedback', 'svelte-8js1iq') // Brave classes
                                footerContent.textContent = chosenAd.text.length < 49 ? chosenAd.text
                                                          : chosenAd.text.slice(0, 49) + '...'
                                footerContent.setAttribute('title', chosenAd.tooltip ||
                                    footerContent.textContent.includes('...') ? chosenAd.text : '')
                                adSelected = true ; break
                            }
                            if (adSelected) break // out of campaign loop after ad selection
        }})}})

        function fetchJSON(url, callback) { // for dynamic footer
            GM.xmlHttpRequest({ method: 'GET', url: url, onload: response => {
                if (response.status >= 200 && response.status < 300) {
                    try { const data = JSON.parse(response.responseText) ; callback(null, data) }
                    catch (err) { callback(err, null) }
                } else callback(new Error('Failed to load data: ' + response.statusText), null)
        }})}

        function shuffle(list) {
            let currentIdx = list.length, tempValue, randomIdx
            while (currentIdx !== 0) { // elements remain to be shuffled
                randomIdx = Math.floor(Math.random() * currentIdx) ; currentIdx -= 1
                tempValue = list[currentIdx] ; list[currentIdx] = list[randomIdx] ; list[randomIdx] = tempValue
            }
            return list
        }

        function applyBoosts(list) {
            let boostedList = [...list],
                boostedListLength = boostedList.length - 1 // for applying multiple boosts
            list.forEach(([name, data]) => { // check for boosts
                if (data.boost) { // boost flagged entry's selection probability
                    const boostPercent = parseInt(data.boost, 10) / 100,
                          entriesNeeded = Math.ceil(boostedListLength / (1 - boostPercent)) // total entries needed
                                        * boostPercent - 1 // reduced to boosted entries needed
                    for (let i = 0 ; i < entriesNeeded ; i++) boostedList.push([name, data]) // saturate list
                    boostedListLength += entriesNeeded // update for subsequent calculations
            }})
            return boostedList
        }
    }

    // Define FACTORY functions

    function createSVGpath(attrs) {
        const path = document.createElementNS('http://www.w3.org/2000/svg', 'path')
        for (const attr in attrs) path.setAttributeNS(null, attr, attrs[attr])
        return path
    }

    function createAnchor(linkHref, displayContent) {
        const anchor = document.createElement('a'),
              anchorAttrs = [['href', linkHref], ['target', '_blank'], ['rel', 'noopener']]
        anchorAttrs.forEach(([attr, value]) => anchor.setAttribute(attr, value))
        if (displayContent) {
            if (typeof displayContent == 'string') anchor.textContent = displayContent
            else if (displayContent instanceof HTMLElement) anchor.append(displayContent)
        }
        return anchor
    }

    // Define TOOLTIP functions

    function toggleTooltip(event) { // visibility
        tooltipDiv.eventYpos = event.currentTarget.getBoundingClientRect().top // for updateTooltip() y-pos calc
        updateTooltip(event.currentTarget.id.replace(/-btn$/, ''))
        tooltipDiv.style.opacity = event.type == 'mouseover' ? 0.8 : 0
    }

    function updateTooltip(buttonType) { // text & position
        const cornerBtnTypes = ['about', 'speak', 'ssb', 'wsb'],
              [ctrAddend, spreadFactor] = document.querySelector('.standby-btn') ? [15, 18] : [5, 28],
              iniRoffset = spreadFactor * (buttonType == 'send' ? 1.65 : cornerBtnTypes.indexOf(buttonType) + 1) + ctrAddend

        // Update text
        tooltipDiv.innerText = (
            buttonType == 'about' ? messages.menuLabel_about || 'About'
          : buttonType == 'speak' ? messages.tooltip_playAnswer || 'Play answer'
          : buttonType == 'ssb' ? (( config.stickySidebar ? `${ messages.prefix_exit || 'Exit' } ` :  '' )
                                   + messages.menuLabel_stickySidebar || 'Sticky Sidebar' )
          : buttonType == 'wsb' ? (( config.widerSidebar ? `${ messages.prefix_exit || 'Exit' } ` :  '' )
                                   + messages.menuLabel_widerSidebar || 'Wider Sidebar' )
          : buttonType == 'send' ? messages.tooltip_sendReply || 'Send reply' : '' )

        // Update position
        tooltipDiv.style.top = `${ buttonType != 'send' ? -6
          : tooltipDiv.eventYpos - appDiv.getBoundingClientRect().top - 34 }px`
        tooltipDiv.style.right = `${ iniRoffset - tooltipDiv.getBoundingClientRect().width / 2 }px`
    }

    // Define SESSION functions

    function isBlockedbyCloudflare(resp) {
        try {
            const html = new DOMParser().parseFromString(resp, 'text/html'),
                  title = html.querySelector('title')
            return title.innerText == 'Just a moment...'
        } catch (err) { return false }
    }

    function deleteOpenAIcookies() {
        if (getUserscriptManager() != 'Tampermonkey') return
        GM_cookie.list({ url: openAIendpoints.auth }, (cookies, error) => {
            if (!error) { for (const cookie of cookies) {
                GM_cookie.delete({ url: openAIendpoints.auth, name: cookie.name })
    }}})}

    function getOpenAItoken() {
        return new Promise(resolve => {
            const accessToken = GM_getValue(config.keyPrefix + '_openAItoken')
            appInfo('OpenAI access token: ' + accessToken)
            if (!accessToken) {
                GM.xmlHttpRequest({ url: openAIendpoints.session, onload: response => {
                    if (isBlockedbyCloudflare(response.responseText)) {
                        appAlert('checkCloudflare') ; return }
                    try {
                        const newAccessToken = JSON.parse(response.responseText).accessToken
                        GM_setValue(config.keyPrefix + '_openAItoken', newAccessToken)
                        resolve(newAccessToken)
                    } catch { appAlert('login') ; return }
                }})
            } else resolve(accessToken)
    })}

    function getAIGCFkey() {
        return new Promise(resolve => {
            const publicKey = GM_getValue(config.keyPrefix + '_aigcfKey')
            if (!publicKey) {
                GM.xmlHttpRequest({ method: 'GET', url: 'https://api.aigcfun.com/fc/key',
                    headers: {
                        'Content-Type': 'application/json',
                        'Referer': 'https://aigcfun.com/',
                        'X-Forwarded-For': ipv4.generate({ verbose: false }) },
                    onload: response => {
                        const newPublicKey = JSON.parse(response.responseText).data
                        if (!newPublicKey) { appError('Failed to get AIGCFun public key') ; return }
                        GM_setValue(config.keyPrefix + '_aigcfKey', newPublicKey)
                        console.info('AIGCFun public key set: ' + newPublicKey)
                        resolve(newPublicKey)
                    },
                    onerror: resolve('')
            })
            } else resolve(publicKey)
    })}

    async function refreshAIGCFendpoint() {
        GM_setValue(config.keyPrefix + '_aigcfKey', false) // clear GM key
        // Determine index of AIGCF in endpoint map
        let aigcfMapIndex = -1
        for (let i = 0 ; i < proxyEndpoints.length ; i++) {
            const endpoint = proxyEndpoints[i]
            if (endpoint.some(item => item.includes('aigcfun'))) {
                aigcfMapIndex = i ; break
        }}
        // Update AIGCF endpoint w/ fresh key (using fresh IP)
        proxyEndpoints[aigcfMapIndex][0] = (
            'https://api.aigcfun.com/api/v1/text?key=' + await getAIGCFkey())
    }

    // Define ANSWER functions

    let endpoint, accessKey, model
    async function pickAPI() {
        if (config.proxyAPIenabled) { // randomize proxy API
            const untriedEndpoints = proxyEndpoints.filter(
                entry => !getShowReply.triedEndpoints?.includes(entry[0]))
            const entry = untriedEndpoints[Math.floor(chatgpt.randomFloat() * untriedEndpoints.length)]
            endpoint = entry[0] ; accessKey = entry[1] ; model = entry[2]
        } else { // use OpenAI API
            endpoint = openAIendpoints.chat
            const timeoutPromise = new Promise((resolve, reject) =>
                setTimeout(() => reject(new Error('Timeout occurred')), 3000))
            accessKey = await Promise.race([getOpenAItoken(), timeoutPromise])
            if (!accessKey) { appAlert('login') ; return }
            model = 'gpt-3.5-turbo'
        }
    }

    function createHeaders(api) {
        let headers = { 'Content-Type': 'application/json' }
        if (api.includes('openai.com')) headers.Authorization = 'Bearer ' + accessKey
        return headers
    }

    function createPayload(api, msgs) {
        const payload = { messages: msgs, model: model }
        if (api.includes('openai.com')) payload.max_tokens = 4000
        return JSON.stringify(payload)
    }

    function getRelatedQueries(query) {
        return new Promise((resolve, reject) => {
            const rqPrompt = 'Show a numbered list of queries related to this one:\n\n' + query
                           + '\n\nMake sure to suggest a variety that can even greatly deviate from the original topic.'
                           + ' For example, if the original query asked about someone\'s wife,'
                               + ' a good related query could involve a different relative and using their name.'
                           + ' Another example, if the query asked about a game/movie/show,'
                               + ' good related queries could involve pertinent characters.'
                           + ' Another example, if the original query asked how to learn JavaScript,'
                               + ' good related queries could ask why/when/where instead, even replacing JS w/ other languages.'
                           + ' But the key is variety. Do not be repetitive.'
                               + ' You must entice user to want to ask one of your related queries.'
            GM.xmlHttpRequest({
                method: 'POST', url: endpoint, responseType: 'text', headers: createHeaders(endpoint),
                data: createPayload(endpoint, [{ role: 'user', content: rqPrompt }]),
                onload: event => {
                    let str_relatedQueries = ''
                    if (!config.proxyAPIenabled && event.response) {
                        try { // to parse txt response from OpenAI API
                            str_relatedQueries = JSON.parse(event.response).choices[0].message.content
                        } catch (err) { appError(err) ; reject(err) }
                    } else if (config.proxyAPIenabled && event.responseText) {
                        try { // to parse txt response from proxy API
                            str_relatedQueries = JSON.parse(event.responseText).choices[0].message.content
                        } catch (err) { appError(err) ; reject(err) }
                    }
                    const arr_relatedQueries = (str_relatedQueries.match(/\d+\.\s*(.*?)(?=\n|$)/g) || [])
                        .slice(0, 5) // limit to 1st 5
                        .map(match => match.replace(/^\d+\.\s*/, '')) // strip numbering
                    resolve(arr_relatedQueries)
                },
                onerror: err => { appError(err) ; reject(err) }
            })
    })}

    function rqEventHandler(event) { // for attachment/removal in `getShowReply()` + `appShow().handleSubmit()`
        if ([' ', 'Enter'].includes(event.key) || event.type == 'click') {
            event.preventDefault() // prevent scroll on space taps

            // Remove divs/listeners
            const relatedQueriesDiv = document.querySelector('.related-queries')
            Array.from(relatedQueriesDiv.children).forEach(relatedQueryDiv => {
                relatedQueryDiv.removeEventListener('click', rqEventHandler)
                relatedQueryDiv.removeEventListener('keydown', rqEventHandler)
            })
            relatedQueriesDiv.remove()

            // Send related query
            const chatbar = appDiv.querySelector('textarea')
            if (chatbar) {
                chatbar.value = event.target.textContent
                chatbar.dispatchEvent(new KeyboardEvent('keydown', {
                    key: 'Enter', bubbles: true, cancelable: true }))
    }}}

    async function getShowReply(convo, callback) {

        // Initialize attempt properties
        if (!getShowReply.triedEndpoints) getShowReply.triedEndpoints = []
        if (!getShowReply.attemptCnt) getShowReply.attemptCnt = 0

        // Get/show answer from ChatGPT
        await pickAPI()
        GM.xmlHttpRequest({
            method: 'POST', url: endpoint, headers: createHeaders(endpoint),
            responseType: 'text', data: createPayload(endpoint, convo), onload: onLoad(),
            onerror: err => {
                appError(err)
                if (!config.proxyAPIenabled) appAlert(!accessKey ? 'login' : 'suggestProxy')
                else { // if proxy mode
                    if (getShowReply.attemptCnt < proxyEndpoints.length) retryDiffHost()
                    else appAlert('suggestOpenAI')
            }}
        })

        // Get/show related queries
        if (!config.rqDisabled) {
            const lastQuery = convo[convo.length - 1]
            getRelatedQueries(lastQuery.content).then(relatedQueries => {
                if (relatedQueries && appDiv.querySelector('textarea')) {

                    // Create/classify/append parent div
                    const relatedQueriesDiv = document.createElement('div')
                    relatedQueriesDiv.className = 'related-queries'
                    appDiv.append(relatedQueriesDiv)

                    // Fill each child div, add attributes + icon + listener
                    relatedQueries.forEach((relatedQuery, index) => {
                        const relatedQueryDiv = document.createElement('div'),
                              relatedQuerySVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),
                              relatedQuerySVGpath = document.createElementNS('http://www.w3.org/2000/svg','path')

                        // Add attributes
                        relatedQueryDiv.title = messages.tooltip_sendRelatedQuery || 'Send related query'
                        relatedQueryDiv.classList.add('related-query', 'fade-in', 'no-user-select')
                        relatedQueryDiv.setAttribute('tabindex', 0)
                        relatedQueryDiv.textContent = relatedQuery

                        // Create icon
                        for (const [attr, value] of [
                            ['viewBox', '0 0 24 24'], ['width', 18], ['height', 18], ['fill', 'currentColor']
                        ]) relatedQuerySVG.setAttribute(attr, value)
                        relatedQuerySVGpath.setAttribute('d',
                            'M16 10H6.83L9 7.83l1.41-1.41L9 5l-6 6 6 6 1.41-1.41L9 14.17 6.83 12H16c1.65 0 3 1.35 3 3v4h2v-4c0-2.76-2.24-5-5-5z')
                        relatedQuerySVG.style.transform = 'rotate(180deg)' // flip arrow upside down

                        // Assemble/insert elements
                        relatedQuerySVG.append(relatedQuerySVGpath) ; relatedQueryDiv.prepend(relatedQuerySVG)
                        relatedQueriesDiv.append(relatedQueryDiv)

                        // Add fade + listeners
                        setTimeout(() => {
                            relatedQueryDiv.classList.add('active')
                            relatedQueryDiv.addEventListener('click', rqEventHandler)
                            relatedQueryDiv.addEventListener('keydown', rqEventHandler)
                        }, index * 100)
                    })

                    updateTweaksStyle() // to shorten <pre> max-height
        }})}

        updateFooterContent()

        function retryDiffHost() {
            appError(`Error calling ${ endpoint }. Trying another endpoint...`)
            getShowReply.triedEndpoints.push(endpoint) // store current proxy to not retry
            getShowReply.attemptCnt++
            getShowReply(convo, callback)
        }

        function onLoad() { // process text
            return async event => {
                if (event.status !== 200) {
                    appError('Event status: ' + event.status)
                    appError('Event response: ' + event.responseText)
                    if (config.proxyAPIenabled && getShowReply.attemptCnt < proxyEndpoints.length)
                        retryDiffHost()
                    else if (event.status === 401 && !config.proxyAPIenabled) {
                        GM_deleteValue(config.keyPrefix + '_openAItoken') ; appAlert('login') }
                    else if (event.status === 403)
                        appAlert(config.proxyAPIenabled ? 'suggestOpenAI' : 'checkCloudflare')
                    else if (event.status === 429) appAlert('tooManyRequests')
                    else appAlert(config.proxyAPIenabled ? 'suggestOpenAI' : 'suggestProxy')
                } else if (endpoint.includes('openai')) {
                    if (event.response) {
                        try { // to parse txt response from OpenAI endpoint
                            appShow(JSON.parse(event.response).choices[0].message.content, footerContent)
                        } catch (err) {
                            appError(appAlerts.parseFailed + ': ' + err)
                            appError('Response: ' + event.response)
                            appAlert('suggestProxy')
                        }
                    }
                } else if (endpoint.includes('aigcf')) {
                    if (event.responseText) {
                        try { // to parse txt response from AIGCF endpoint
                            const answer = JSON.parse(event.responseText).choices[0].message.content
                            appShow(answer, footerContent) ; getShowReply.triedEndpoints = [] ; getShowReply.attemptCnt = 0
                        } catch (err) {
                            appInfo('Response: ' + event.responseText)
                            if (event.responseText.includes('非常抱歉，根据我们的产品规则，无法为你提供该问题的回答'))
                                appAlert(messages.alert_censored || 'Sorry, according to our product rules, '
                                    + 'we cannot provide you with an answer to this question, please try other questions')
                            else if (event.responseText.includes('维护'))
                                appAlert(( messages.alert_maintenance || 'AI system under maintenance' ) + '. '
                                    + ( messages.alert_suggestOpenAI || 'Try switching off Proxy Mode in toolbar' ))
                            else if (event.responseText.includes('finish_reason')) { // if other AIGCF error encountered
                                await refreshAIGCFendpoint() ; getShowReply(convo, callback) // re-fetch related queries w/ fresh IP
                            } else { // use different endpoint or suggest OpenAI
                                appError(appAlerts.parseFailed + ': ' + err)
                                if (getShowReply.attemptCnt < proxyEndpoints.length) retryDiffHost()
                                else appAlert('suggestOpenAI')
        }}}}}}
    }

    function appShow(answer, footerContent) {
        while (appDiv.firstChild) // clear all children
            appDiv.removeChild(appDiv.firstChild)

        // Create/append '🤖 BraveGPT'
        if (!appLogoImg.loaded) { // create/append robot emoji for logo alt
            const appPrefixSpan = document.createElement('span')
            appPrefixSpan.innerText = '🤖 ' ; appPrefixSpan.classList.add('app-name', 'no-user-select')
            appDiv.append(appPrefixSpan)
        }
        const appLogoAnchor = createAnchor(config.appURL, appLogoImg)
        appLogoAnchor.classList.add('app-name', 'no-user-select') ; appLogoImg.width = 152
        if (!appLogoImg.loaded) appLogoImg.style.marginLeft = '3px' // pos logo alt
        appDiv.append(appLogoAnchor)

        // Create/append 'by KudoAI'
        const kudoAIspan = document.createElement('span')
        kudoAIspan.classList.add('kudo-ai', 'no-user-select') ; kudoAIspan.textContent = 'by '
        kudoAIspan.style.cssText = appLogoImg.loaded ? 'position: relative ; bottom: 8px ; font-size: 12px' : ''
        const kudoAIlink = createAnchor('https://www.kudoai.com', 'KudoAI')
        kudoAIspan.append(kudoAIlink) ; appDiv.append(kudoAIspan)

        // Create/append about button
        const aboutSpan = document.createElement('span'),
              aboutSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),
              aboutSVGpath = document.createElementNS('http://www.w3.org/2000/svg','path')
        aboutSpan.id = 'about-btn' // for toggleTooltip()
        aboutSpan.className = 'corner-btn'
        const aboutSVGattrs = [['width', 17], ['height', 17], ['viewBox', '0 0 56.693 56.693']]
        aboutSVGattrs.forEach(([attr,value]) => aboutSVG.setAttribute(attr, value))            
        aboutSVGpath.setAttribute('d',
            'M28.765,4.774c-13.562,0-24.594,11.031-24.594,24.594c0,13.561,11.031,24.594,24.594,24.594  c13.561,0,24.594-11.033,24.594-24.594C53.358,15.805,42.325,4.774,28.765,4.774z M31.765,42.913c0,0.699-0.302,1.334-0.896,1.885  c-0.587,0.545-1.373,0.82-2.337,0.82c-0.993,0-1.812-0.273-2.431-0.814c-0.634-0.551-0.954-1.188-0.954-1.891v-1.209  c0-0.703,0.322-1.34,0.954-1.891c0.619-0.539,1.438-0.812,2.431-0.812c0.964,0,1.75,0.277,2.337,0.82  c0.594,0.551,0.896,1.186,0.896,1.883V42.913z M38.427,24.799c-0.389,0.762-0.886,1.432-1.478,1.994  c-0.581,0.549-1.215,1.044-1.887,1.473c-0.643,0.408-1.248,0.852-1.798,1.315c-0.539,0.455-0.99,0.963-1.343,1.512  c-0.336,0.523-0.507,1.178-0.507,1.943v0.76c0,0.504-0.247,1.031-0.735,1.572c-0.494,0.545-1.155,0.838-1.961,0.871l-0.167,0.004  c-0.818,0-1.484-0.234-1.98-0.699c-0.532-0.496-0.801-1.055-0.801-1.658c0-1.41,0.196-2.611,0.584-3.572  c0.385-0.953,0.86-1.78,1.416-2.459c0.554-0.678,1.178-1.27,1.854-1.762c0.646-0.467,1.242-0.93,1.773-1.371  c0.513-0.428,0.954-0.885,1.312-1.354c0.328-0.435,0.489-0.962,0.489-1.608c0-1.066-0.289-1.83-0.887-2.334  c-0.604-0.512-1.442-0.771-2.487-0.771c-0.696,0-1.294,0.043-1.776,0.129c-0.471,0.083-0.905,0.223-1.294,0.417  c-0.384,0.19-0.745,0.456-1.075,0.786c-0.346,0.346-0.71,0.783-1.084,1.301c-0.336,0.473-0.835,0.83-1.48,1.062  c-0.662,0.239-1.397,0.175-2.164-0.192c-0.689-0.344-1.11-0.793-1.254-1.338c-0.135-0.5-0.135-1.025-0.002-1.557  c0.098-0.453,0.369-1.012,0.83-1.695c0.451-0.67,1.094-1.321,1.912-1.938c0.814-0.614,1.847-1.151,3.064-1.593  c1.227-0.443,2.695-0.668,4.367-0.668c1.648,0,3.078,0.249,4.248,0.742c1.176,0.496,2.137,1.157,2.854,1.967  c0.715,0.809,1.242,1.738,1.568,2.762c0.322,1.014,0.486,2.072,0.486,3.146C39.024,23.075,38.823,24.024,38.427,24.799z')
        aboutSVGpath.setAttribute('stroke', 'none')
        aboutSVG.append(aboutSVGpath) ; aboutSpan.append(aboutSVG) ; appDiv.append(aboutSpan)

        // Create/append speak button
        if (answer != 'standby') {
            var speakSpan = document.createElement('span'),
                speakSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
            speakSpan.id = 'speak-btn' // for toggleTooltip()
            speakSpan.className = 'corner-btn' ; speakSpan.style.margin = '-0.04em 5px 0 0'
            const speakSVGattrs = [['width', 22], ['height', 22], ['viewBox', '0 0 32 32']]
            speakSVGattrs.forEach(([attr, value]) => speakSVG.setAttributeNS(null, attr, value))
            const speakSVGpaths = [
                createSVGpath({ stroke: '', 'stroke-width': '2px', fill: 'none',
                    d: 'M24.5,26c2.881,-2.652 4.5,-6.249 4.5,-10c0,-3.751 -1.619,-7.348 -4.5,-10' }),
                createSVGpath({ stroke: '', 'stroke-width': '2px', fill: 'none',
                    d: 'M22,20.847c1.281,-1.306 2,-3.077 2,-4.924c0,-1.846 -0.719,-3.617 -2,-4.923' }),
                createSVGpath({ stroke: 'none', fill: '',
                    d: 'M9.957,10.88c-0.605,0.625 -1.415,0.98 -2.262,0.991c-4.695,0.022 -4.695,0.322 -4.695,4.129c0,3.806 0,4.105 4.695,4.129c0.846,0.011 1.656,0.366 2.261,0.991c1.045,1.078 2.766,2.856 4.245,4.384c0.474,0.49 1.18,0.631 1.791,0.36c0.611,-0.272 1.008,-0.904 1.008,-1.604c0,-4.585 0,-11.936 0,-16.52c0,-0.7 -0.397,-1.332 -1.008,-1.604c-0.611,-0.271 -1.317,-0.13 -1.791,0.36c-1.479,1.528 -3.2,3.306 -4.244,4.384Z' })
            ]
            speakSVGpaths.forEach(path => speakSVG.append(path))
            speakSpan.append(speakSVG) ; appDiv.append(speakSpan)
        }

        if (!isMobile) {

            // Create/append Sticky Sidebar button
            var ssbSpan = document.createElement('span'),
                ssbSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
            ssbSpan.id = 'ssb-btn' // for updateSSBsvg() + toggleTooltip()
            ssbSpan.className = 'corner-btn' ; ssbSpan.style.margin = '0.01rem 6px 0 0'
            ssbSpan.append(ssbSVG) ; appDiv.append(ssbSpan) ; updateSSBsvg()

            // Create/append Wider Sidebar button
            var wsbSpan = document.createElement('span'),
                wsbSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg')
            wsbSpan.id = 'wsb-btn' // for updateWSBsvg() + toggleTooltip()
            wsbSpan.className = 'corner-btn' ; wsbSpan.style.margin = '0.07rem 9px 0 0'
            wsbSpan.append(wsbSVG) ; appDiv.append(wsbSpan) ; updateWSBsvg()
        }

        // Add tooltips
        appDiv.append(tooltipDiv)

        // Add corner button listeners
        aboutSVG.addEventListener('click', launchAboutModal)
        speakSVG?.addEventListener('click', () => {
            const dialectMap = [
                { code: 'en', regex: /^(eng(lish)?|en(-\w\w)?)$/i, rate: 2 },
                { code: 'ar', regex: /^(ara?(bic)?|اللغة العربية)$/i, rate: 1.5 },
                { code: 'cs', regex: /^(cze(ch)?|[cč]e[sš].*|cs)$/i, rate: 1.4 },
                { code: 'da', regex: /^dan?(ish|sk)?$/i, rate: 1.3 },
                { code: 'de', regex: /^(german|deu?(tsch)?)$/i, rate: 1.5 },
                { code: 'es', regex: /^(spa(nish)?|espa.*|es(-\w\w)?)$/i, rate: 1.5 },
                { code: 'fi', regex: /^(fin?(nish)?|suom.*)$/i, rate: 1.4 },
                { code: 'fr', regex: /^fr/i, rate: 1.2 },
                { code: 'hu', regex: /^(hun?(garian)?|magyar)$/i, rate: 1.5 },
                { code: 'it', regex: /^ita?(lian[ao]?)?$/i, rate: 1.4 },
                { code: 'ja', regex: /^(ja?pa?n(ese)?|日本語|ja)$/i, rate: 1.5 },
                { code: 'nl', regex: /^(dut(ch)?|flemish|nederlandse?|vlaamse?|nld?)$/i, rate: 1.3 },
                { code: 'pl', regex: /^po?l(ish|ski)?$/i, rate: 1.4 },
                { code: 'pt', regex: /^(por(tugu[eê]se?)?|pt(-\w\w)?)$/i, rate: 1.5 },
                { code: 'ru', regex: /^(rus?(sian)?|русский)$/i, rate: 1.3 },
                { code: 'sv', regex: /^(swe?(dish)?|sv(enska)?)$/i, rate: 1.4 },
                { code: 'tr', regex: /^t[uü]?r(k.*)?$/i, rate: 1.6 },
                { code: 'vi', regex: /^vi[eệ]?t?(namese)?$/i, rate: 1.5 },
                { code: 'zh-CHS', regex: /^(chi(nese)?|zh|中[国國])/i, rate: 2 }
            ]
            const replyDialect = dialectMap.find(entry => entry.regex.test(config.replyLanguage)) || dialectMap[0],
                  payload = { text: answer, curTime: Date.now(), spokenDialect: replyDialect.code, rate: replyDialect.rate.toString() },
                  key = CryptoJS.enc.Utf8.parse('76350b1840ff9832eb6244ac6d444366'),
                  iv = CryptoJS.enc.Utf8.parse(atob('AAAAAAAAAAAAAAAAAAAAAA==') || '76350b1840ff9832eb6244ac6d444366')
            const securePayload = CryptoJS.AES.encrypt(JSON.stringify(payload), key, {
                iv: iv, mode: CryptoJS.mode.CBC, pad: CryptoJS.pad.Pkcs7 }).toString()
            GM.xmlHttpRequest({ // audio from Sogou TTS
                url: 'https://fanyi.sogou.com/openapi/external/getWebTTS?S-AppId=102356845&S-Param='
                    + encodeURIComponent(securePayload),
                method: 'GET', responseType: 'arraybuffer',
                onload: async response => {
                    if (response.status !== 200) chatgpt.speak(answer, { voice: 2, pitch: 1, speed: 1.5 })
                    else {
                        const audioContext = new (window.AudioContext || window.webkitAudioContext)()
                        audioContext.decodeAudioData(response.response, buffer => {
                            const audioSrc = audioContext.createBufferSource()
                            audioSrc.buffer = buffer
                            audioSrc.connect(audioContext.destination) // connect source to speakers
                            audioSrc.start(0) // play audio
                })}}
            })
        })
        ssbSVG?.addEventListener('click', () => toggleSidebar('sticky'))
        wsbSVG?.addEventListener('click', () => toggleSidebar('wider'))
        const buttonSpans = [aboutSpan, speakSpan, ssbSpan, wsbSpan]
        buttonSpans.forEach(span => { if (span) { // add hover listeners for tooltips
            span.addEventListener('mouseover', toggleTooltip)
            span.addEventListener('mouseout', toggleTooltip)
        }})

        // Show standby state if prefix/suffix mode on
        if (answer == 'standby') {
            const standbyBtn = document.createElement('button')
            standbyBtn.className = 'standby-btn'
            standbyBtn.textContent = messages.buttonLabel_sendQueryToGPT || 'Send search query to GPT'
            appDiv.append(standbyBtn)
            standbyBtn.addEventListener('click', () => {
                appAlert('waitingResponse')
                const query = `${ new URL(location.href).searchParams.get('q') } (reply in ${ config.replyLanguage })`
                convo.push({ role: 'user', content: query })
                getShowReply(convo)
            })

        // Otherwise create/append ChatGPT response
        } else {
            const balloonTipSpan = document.createElement('span')
            var answerPre = document.createElement('pre')
            balloonTipSpan.className = 'balloon-tip' ; answerPre.textContent = answer
            appDiv.append(balloonTipSpan) ; appDiv.append(answerPre)
        }

        setTimeout(() => updateTweaksStyle(), 100) // in case sticky mode on

        // Create/append reply section/elements
        const replySection = document.createElement('section'),
              replyForm = document.createElement('form'),
              continueChatDiv = document.createElement('div'),
              chatTextarea = document.createElement('textarea')
        continueChatDiv.className = 'continue-chat'
        chatTextarea.id = 'app-chatbar' ; chatTextarea.rows = '1'
        chatTextarea.placeholder = ( answer == 'standby' ? messages.placeholder_askSomethingElse || 'Ask something else'
                                                         : messages.tooltip_sendReply || 'Send reply' ) + '...'
        continueChatDiv.append(chatTextarea)
        replyForm.append(continueChatDiv) ; replySection.append(replyForm)
        appDiv.append(replySection)

        // Create/append send button
        const sendButton = document.createElement('button'),
              sendSVG = document.createElementNS('http://www.w3.org/2000/svg', 'svg'),
              sendSVGpath = createSVGpath({ stroke: '', 'stroke-width': '2', linecap: 'round',
                  'stroke-linejoin': 'round', d: 'M7 11L12 6L17 11M12 18V7' })
        sendButton.id = 'send-btn'
        sendButton.style.right = '10px' ; sendButton.style.bottom = `${ isFirefox ? 56 : 60 }px`
        for (const [attr, value] of [
            ['viewBox', '4 2 16 16'], ['fill', 'none'], ['height', 16], ['width', 16],
            ['stroke', 'currentColor'], ['stroke-width', '2'], ['stroke-linecap', 'round'], ['stroke-linejoin', 'round']
        ]) sendSVG.setAttribute(attr, value)
        sendSVG.append(sendSVGpath) ; sendButton.append(sendSVG) ; continueChatDiv.append(sendButton)

        // Create/classify/fill/append footer
        const appFooter = document.createElement('footer')
        appFooter.append(footerContent) ; appDiv.append(appFooter)

        // Render math
        if (answer != 'standby') {
            renderMathInElement(answerPre, { // eslint-disable-line no-undef
                delimiters: [
                    { left: '$$', right: '$$', display: true },
                    { left: '$', right: '$', display: false },
                    { left: '\\(', right: '\\)', display: false },
                    { left: '\\[', right: '\\]', display: true },
                    { left: '\\begin{equation}', right: '\\end{equation}', display: true },
                    { left: '\\begin{align}', right: '\\end{align}', display: true },
                    { left: '\\begin{alignat}', right: '\\end{alignat}', display: true },
                    { left: '\\begin{gather}', right: '\\end{gather}', display: true },
                    { left: '\\begin{CD}', right: '\\end{CD}', display: true },
                    { left: '\\[', right: '\\]', display: true }
                ],
                throwOnError: false
        })}

        // Add reply section listeners
        replyForm.addEventListener('keydown', handleEnter)
        replyForm.addEventListener('submit', handleSubmit)
        chatTextarea.addEventListener('input', autosizeChatbar)
        sendButton.addEventListener('mouseover', toggleTooltip)
        sendButton.addEventListener('mouseout', toggleTooltip)

        function handleEnter(event) {
            if (event.key == 'Enter') {
                if (event.ctrlKey) { // add newline
                    const chatTextarea = document.querySelector('#app-chatbar'),
                          caretPos = chatTextarea.selectionStart,
                          textBefore = chatTextarea.value.substring(0, caretPos),
                          textAfter = chatTextarea.value.substring(caretPos)
                    chatTextarea.value = textBefore + '\n' + textAfter // add newline
                    chatTextarea.selectionStart = chatTextarea.selectionEnd = caretPos + 1 // preserve caret pos
                    autosizeChatbar()
                } else if (!event.shiftKey) handleSubmit(event)
        }}

        function handleSubmit(event) {
            event.preventDefault()
            if (convo.length > 2) convo.splice(0, 2) // keep token usage maintainable
            const prevReplyTrimmed = appDiv.querySelector('pre')?.textContent.substring(0, 250 - chatTextarea.value.length) || '',
                  yourReply = `${ chatTextarea.value } (reply in ${ config.replyLanguage })`
            convo.push({ role: 'assistant', content: prevReplyTrimmed })
            convo.push({ role: 'user', content: yourReply })
            getShowReply(convo)

            // Remove re-added reply section listeners
            replyForm.removeEventListener('keydown', handleEnter)
            replyForm.removeEventListener('submit', handleSubmit)
            chatTextarea.removeEventListener('input', autosizeChatbar)

            // Remove related queries
            try {
                const relatedQueriesDiv = document.querySelector('.related-queries')
                Array.from(relatedQueriesDiv.children).forEach(relatedQueryDiv => {
                    relatedQueryDiv.removeEventListener('click', rqEventHandler)
                    relatedQueryDiv.removeEventListener('keydown', rqEventHandler)
                })
                relatedQueriesDiv.remove()
            } catch (err) {}

            // Clear footer
            while (appFooter.firstChild) // clear all children
                appFooter.removeChild(appFooter.firstChild)

            // Show loading status
            replySection.classList.add('loading', 'no-user-select')
            replySection.innerText = appAlerts.waitingResponse
        }

        let prevLength = chatTextarea.value.length
        function autosizeChatbar() {
            const newLength = chatTextarea.value.length
            if (newLength < prevLength) { // if deleting txt
                chatTextarea.style.height = 'auto' // ...auto-fit height
                if (parseInt(getComputedStyle(chatTextarea).height) < 55) { // if down to one line
                    chatTextarea.style.height = '2.15rem' } // ...reset to original height
            }
            chatTextarea.style.height = chatTextarea.scrollHeight > 55 ? chatTextarea.scrollHeight + 'px' : '2.15rem'
            prevLength = newLength
        }
    }

    // Run MAIN routine

    // Init config/convo/menu
    const config = {
        appName: 'BraveGPT', appSymbol: '🤖', keyPrefix: 'braveGPT',
        appURL: 'https://www.bravegpt.com', gitHubURL: 'https://github.com/KudoAI/bravegpt',
        greasyForkURL: 'https://greasyfork.org/scripts/462440-bravegpt',
        userLanguage: chatgpt.getUserLanguage() }
    config.updateURL = config.greasyForkURL.replace('https://', 'https://update.')
        .replace(/(\d+)-?([a-zA-Z-]*)$/, (_, id, name) => `${ id }/${ !name ? 'script' : name }.meta.js`)
    config.supportURL = config.gitHubURL + '/issues/new'
    config.feedbackURL = config.gitHubURL + '/discussions/new/choose'
    config.assetHostURL = config.gitHubURL.replace('github.com', 'raw.githubusercontent.com') + '/main/'
    config.userLocale = config.userLanguage.includes('-') ? config.userLanguage.split('-')[1].toLowerCase() : ''
    loadSetting('autoGetDisabled', 'prefixEnabled', 'proxyAPIenabled', 'replyLanguage',
                'rqDisabled', 'stickySidebar', 'suffixEnabled', 'widerSidebar')
    if (!config.replyLanguage) saveSetting('replyLanguage', config.userLanguage) // init reply language if unset
    const convo = [], menuIDs = []
    const state = {
        symbol: ['✔️', '❌'], word: ['ON', 'OFF'],
        separator: getUserscriptManager() == 'Tampermonkey' ? ' — ' : ': ' }

    // Init UI flags
    const scheme = isDarkMode() ? 'dark' : 'light',
          isChromium = chatgpt.browser.isChromium(),
          isFirefox = chatgpt.browser.isFirefox(),
          isMobile = chatgpt.browser.isMobile()

    // Pre-load logo
    const appLogoImg = document.createElement('img')
          appLogoImg.src = 'data:image/png;base64,'
              + ( scheme == 'light' ? 'iVBORw0KGgoAAAANSUhEUgAAAQMAAAA3CAYAAAAITS/EAAAACXBIWXMAAAsTAAALEwEAmpwYAAALbmlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wMy0yMFQyMzowNzowOC0wNzowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTItMjBUMjM6MzYtMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTItMjBUMjM6MzYtMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6ZTFhZjA1M2QtZTQwMy02ZjQyLTgwZDktMzcyMTdkNDg1MWQwIiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6YmE1MmY3YzItM2Y0Mi00YTQ4LTg2OWQtMTRjMzQ2MTFlYzNhIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjdiY2U5OTUtOTdmYS0wODQ4LTg4MjktNmRmMWEwY2MwMDg1IiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSIxIiBleGlmOlBpeGVsWERpbWVuc2lvbj0iNzMwIiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMTU1Ij4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSInZ3B0JyIgcGhvdG9zaG9wOkxheWVyVGV4dD0iZ3B0Ii8+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6VGV4dExheWVycz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyN2JjZTk5NS05N2ZhLTA4NDgtODgyOS02ZGYxYTBjYzAwODUiIHN0RXZ0OndoZW49IjIwMjMtMDMtMjBUMjM6MDc6MDgtMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OWM0MDM4M2MtNzM4OC1jZTQ4LWExODAtZGU1YzRlNGEwNGZhIiBzdEV2dDp3aGVuPSIyMDIzLTAzLTIxVDE5OjQyOjIxLTA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo3ODJiOGU4NC00M2YzLWZjNGQtOTA5Ni00YmI2ODc5NzIxNmMiIHN0RXZ0OndoZW49IjIwMjMtMTItMjBUMjM6MzYtMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOmUxYWYwNTNkLWU0MDMtNmY0Mi04MGQ5LTM3MjE3ZDQ4NTFkMCIgc3RFdnQ6d2hlbj0iMjAyMy0xMi0yMFQyMzozNi0wODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9yeT4gPHhtcE1NOkRl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'
                                    : 'iVBORw0KGgoAAAANSUhEUgAAAQMAAAA3CAYAAAAITS/EAAAACXBIWXMAAAsTAAALEwEAmpwYAAALemlUWHRYTUw6Y29tLmFkb2JlLnhtcAAAAAAAPD94cGFja2V0IGJlZ2luPSLvu78iIGlkPSJXNU0wTXBDZWhpSHpyZVN6TlRjemtjOWQiPz4gPHg6eG1wbWV0YSB4bWxuczp4PSJhZG9iZTpuczptZXRhLyIgeDp4bXB0az0iQWRvYmUgWE1QIENvcmUgNS42LWMxNDIgNzkuMTYwOTI0LCAyMDE3LzA3LzEzLTAxOjA2OjM5ICAgICAgICAiPiA8cmRmOlJERiB4bWxuczpyZGY9Imh0dHA6Ly93d3cudzMub3JnLzE5OTkvMDIvMjItcmRmLXN5bnRheC1ucyMiPiA8cmRmOkRlc2NyaXB0aW9uIHJkZjphYm91dD0iIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtbG5zOmRjPSJodHRwOi8vcHVybC5vcmcvZGMvZWxlbWVudHMvMS4xLyIgeG1sbnM6cGhvdG9zaG9wPSJodHRwOi8vbnMuYWRvYmUuY29tL3Bob3Rvc2hvcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RFdnQ9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZUV2ZW50IyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtbG5zOnRpZmY9Imh0dHA6Ly9ucy5hZG9iZS5jb20vdGlmZi8xLjAvIiB4bWxuczpleGlmPSJodHRwOi8vbnMuYWRvYmUuY29tL2V4aWYvMS4wLyIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiB4bXA6Q3JlYXRlRGF0ZT0iMjAyMy0wMy0yMFQyMzowNzowOC0wNzowMCIgeG1wOk1vZGlmeURhdGU9IjIwMjMtMTItMjBUMjM6MzY6MjQtMDg6MDAiIHhtcDpNZXRhZGF0YURhdGU9IjIwMjMtMTItMjBUMjM6MzY6MjQtMDg6MDAiIGRjOmZvcm1hdD0iaW1hZ2UvcG5nIiBwaG90b3Nob3A6Q29sb3JNb2RlPSIzIiBwaG90b3Nob3A6SUNDUHJvZmlsZT0ic1JHQiBJRUM2MTk2Ni0yLjEiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MGZiNjQ0YjItMjk0Ni1jNTQ1LWJmMjctNmU2YzcwNjdiY2Q2IiB4bXBNTTpEb2N1bWVudElEPSJhZG9iZTpkb2NpZDpwaG90b3Nob3A6NDg1ZjY1ZGMtYTY1OS1kZTRjLTllNzktMGEyN2I2NWY4ZjAyIiB4bXBNTTpPcmlnaW5hbERvY3VtZW50SUQ9InhtcC5kaWQ6MjdiY2U5OTUtOTdmYS0wODQ4LTg4MjktNmRmMWEwY2MwMDg1IiB0aWZmOk9yaWVudGF0aW9uPSIxIiB0aWZmOlhSZXNvbHV0aW9uPSI3MjAwMDAvMTAwMDAiIHRpZmY6WVJlc29sdXRpb249IjcyMDAwMC8xMDAwMCIgdGlmZjpSZXNvbHV0aW9uVW5pdD0iMiIgZXhpZjpDb2xvclNwYWNlPSIxIiBleGlmOlBpeGVsWERpbWVuc2lvbj0iNzMwIiBleGlmOlBpeGVsWURpbWVuc2lvbj0iMTU1Ij4gPHBob3Rvc2hvcDpUZXh0TGF5ZXJzPiA8cmRmOkJhZz4gPHJkZjpsaSBwaG90b3Nob3A6TGF5ZXJOYW1lPSInZ3B0JyIgcGhvdG9zaG9wOkxheWVyVGV4dD0iZ3B0Ii8+IDwvcmRmOkJhZz4gPC9waG90b3Nob3A6VGV4dExheWVycz4gPHhtcE1NOkhpc3Rvcnk+IDxyZGY6U2VxPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iY3JlYXRlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDoyN2JjZTk5NS05N2ZhLTA4NDgtODgyOS02ZGYxYTBjYzAwODUiIHN0RXZ0OndoZW49IjIwMjMtMDMtMjBUMjM6MDc6MDgtMDc6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBpbWFnZS9wbmcgdG8gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0ic2F2ZWQiIHN0RXZ0Omluc3RhbmNlSUQ9InhtcC5paWQ6OWM0MDM4M2MtNzM4OC1jZTQ4LWExODAtZGU1YzRlNGEwNGZhIiBzdEV2dDp3aGVuPSIyMDIzLTAzLTIxVDE5OjQyOjIxLTA3OjAwIiBzdEV2dDpzb2Z0d2FyZUFnZW50PSJBZG9iZSBQaG90b3Nob3AgQ0MgKFdpbmRvd3MpIiBzdEV2dDpjaGFuZ2VkPSIvIi8+IDxyZGY6bGkgc3RFdnQ6YWN0aW9uPSJzYXZlZCIgc3RFdnQ6aW5zdGFuY2VJRD0ieG1wLmlpZDo1ODU0ZWJjNy02Y2Y0LWNmNGMtOWE1ZS0yNmFlOTA2MTI2YTAiIHN0RXZ0OndoZW49IjIwMjMtMTItMjBUMjM6MzY6MjQtMDg6MDAiIHN0RXZ0OnNvZnR3YXJlQWdlbnQ9IkFkb2JlIFBob3Rvc2hvcCBDQyAoV2luZG93cykiIHN0RXZ0OmNoYW5nZWQ9Ii8iLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249ImNvbnZlcnRlZCIgc3RFdnQ6cGFyYW1ldGVycz0iZnJvbSBhcHBsaWNhdGlvbi92bmQuYWRvYmUucGhvdG9zaG9wIHRvIGltYWdlL3BuZyIvPiA8cmRmOmxpIHN0RXZ0OmFjdGlvbj0iZGVyaXZlZCIgc3RFdnQ6cGFyYW1ldGVycz0iY29udmVydGVkIGZyb20gYXBwbGljYXRpb24vdm5kLmFkb2JlLnBob3Rvc2hvcCB0byBpbWFnZS9wbmciLz4gPHJkZjpsaSBzdEV2dDphY3Rpb249InNhdmVkIiBzdEV2dDppbnN0YW5jZUlEPSJ4bXAuaWlkOjBmYjY0NGIyLTI5NDYtYzU0NS1iZjI3LTZlNmM3MDY3YmNkNiIgc3RFdnQ6d2hlbj0iMjAyMy0xMi0yMFQyMzozNjoyNC0wODowMCIgc3RFdnQ6c29mdHdhcmVBZ2VudD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgc3RFdnQ6Y2hhbmdlZD0iLyIvPiA8L3JkZjpTZXE+IDwveG1wTU06SGlzdG9y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' )
    appLogoImg.alt = config.appName
    appLogoImg.onload = () => appLogoImg.loaded = true // for prefix visibility + img/alt pos in `appShow()`

    // Define messages
    const msgsLoaded = new Promise(resolve => {
        const msgHostDir = config.assetHostURL + 'greasemonkey/_locales/',
              msgLocaleDir = ( config.userLanguage ? config.userLanguage.replace('-', '_') : 'en' ) + '/'
        let msgHref = msgHostDir + msgLocaleDir + 'messages.json', msgXHRtries = 0
        GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
        function onLoad(response) {
            try { // to return localized messages.json
                const messages = new Proxy(JSON.parse(response.responseText), {
                    get(target, prop) { // remove need to ref nested keys
                        if (typeof target[prop] == 'object' && target[prop] !== null && 'message' in target[prop]) {
                            return target[prop].message
                }}}) ; resolve(messages)
            } catch (err) { // if 404
                msgXHRtries++ ; if (msgXHRtries === 3) return // try up to 3X (original/region-stripped/EN) only
                msgHref = config.userLanguage.includes('-') && msgXHRtries === 1 ? // if regional lang on 1st try...
                    msgHref.replace(/([^_]*)_[^/]*(\/.*)/, '$1$2') // ...strip region before retrying
                        : ( msgHostDir + 'en/messages.json' ) // else use default English messages
                GM.xmlHttpRequest({ method: 'GET', url: msgHref, onload: onLoad })
            }
        }
    }) ; const messages = await msgsLoaded

    registerMenu()

    // Init endpoints
    const openAIendpoints = {
        auth: 'https://auth0.openai.com',
        session: 'https://chat.openai.com/api/auth/session',
        chat: 'https://api.openai.com/v1/chat/completions' }
    const proxyEndpoints = [[ 'https://api.aigcfun.com/api/v1/text?key=' + await getAIGCFkey(), '', 'gpt-3.5-turbo' ]]

    // Init alerts
    const appAlerts = {
        waitingResponse: ( messages.alert_waitingResponse || 'Waiting for ChatGPT response' ) + '...',
        login: ( messages.alert_login || 'Please login' ) + ' @ ',
        tooManyRequests: ( messages.alert_tooManyRequests || 'ChatGPT is flooded with too many requests' ) + '. '
            + ( config.proxyAPIenabled ? ( messages.alert_suggestOpenAI || 'Try switching off Proxy Mode in toolbar' )
                                       : ( messages.alert_suggestProxy || 'Try switching on Proxy Mode in toolbar' )),
        parseFailed: ( messages.alert_parseFailed || 'Failed to parse response JSON' ) + '. '
            + ( config.proxyAPIenabled ? ( messages.alert_suggestOpenAI || 'Try switching off Proxy Mode in toolbar' )
                                       : ( messages.alert_suggestProxy || 'Try switching on Proxy Mode in toolbar' )),
        checkCloudflare: ( messages.alert_checkCloudflare || 'Please pass Cloudflare security check' ) + ' @ ',
        suggestProxy: ( messages.alert_openAInotWorking || 'OpenAI API is not working' ) + '. '
            + ( messages.alert_suggestProxy || 'Try switching on Proxy Mode in toolbar' ),
        suggestOpenAI: ( messages.alert_proxyNotWorking || 'Proxy API is not working' ) + '. '
            + ( messages.alert_suggestOpenAI || 'Try switching off Proxy Mode in toolbar' )
    }

    // Stylize elements
    const appStyle = document.createElement('style')
    appStyle.innerText = (
          '.no-user-select { -webkit-user-select: none ; -moz-user-select: none ; -ms-user-select: none ; user-select: none }'
        + '.bravegpt {'
            + `word-wrap: break-word ; white-space: pre-wrap ; margin-bottom: ${ isMobile ? -29 : 20}px ;`
            + 'border-radius: 18px ; padding: 24px 23px 45px 23px ; background:'
                + ( scheme == 'dark' ? ( isMobile ? 'var(--search-gray-800)' : '#282828' ) : 'white' ) + '}'
        + '.bravegpt:hover { box-shadow: 0 9px 28px rgba(0, 0, 0, 0.09) }'
        + '.bravegpt p { margin: 0 }'
        + '.bravegpt .chatgpt-icon { position: relative ; bottom: -4px ; margin-right: 11px }'
        + '.app-name { font-size: 20px ; font-family: var(--brand-font) ; text-decoration: none;'
            + `color: ${ scheme == 'dark' ? 'white' : 'black' } !important }`
        + '.corner-btn { float: right ; cursor: pointer ; position: relative ; top: 4px ;'
            + ( scheme == 'dark' ? 'fill: white ; stroke: white;' : 'fill: #adadad ; stroke: #adadad' ) + '}'
        + `.corner-btn:hover { ${ scheme == 'dark' ? 'fill: #aaa ; stroke: #aaa' : 'fill: black ; stroke: black' }}`
        + '.bravegpt .loading {'
            + 'margin-bottom: -55px ;' // offset vs. `.bravegpt` bottom-padding footer accomodation
            + 'color: #b6b8ba ; animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite }'
        + '@keyframes pulse { 0%, to { opacity: 1 } 50% { opacity: .5 }}'
        + '.bravegpt section.loading { padding-left: 5px ; font-size: 90% }'
        + '.standby-btn { width: 100% ; padding: 13px 0 ; cursor: pointer ; margin: 14px 0 20px ;'
            + `border-radius: 4px ; border: 1px solid ${ scheme == 'dark' ? '#fff' : '#000' } ;`
            + 'transition: transform 0.1s ease !important ; transform: scale(1) }'
        + '.standby-btn:hover { border-radius: 4px ; transform: scale(1.025) ;'
            + `${ scheme == 'dark' ? 'background: white ; color: black' : 'background: black ; color: white' }}`
        + '.bravegpt pre {'
            + 'font-family: Consolas, Menlo, Monaco, monospace ; white-space: pre-wrap ; line-height: 21px ;'
            + 'padding: 1.2em ; margin-top: .7em ; border-radius: 13px ; overflow: auto ;'
            + ( scheme == 'dark' ? 'background: #3a3a3a ; color: #f2f2f2 } ' : ' background: #eaeaea ; color: #282828 }' )
        + `.bravegpt footer { margin: ${ isChromium ? 27 : 32 }px 0 -26px 0 ; border-top: none !important }`
        + '.bravegpt .feedback {'
            + 'float: right ; font-family: var(--brand-font) ; font-size: .55rem ;'
            + 'letter-spacing: .02em ; position: relative ; right: -18px ; bottom: 15px ;'
            + `color: ${ scheme == 'dark' ? '#aaa' : 'var(--search-text-06)' }}`
        + '.bravegpt .feedback .icon {'
            + ' fill: currentColor ; color: currentColor ; --size: 12px ; position: relative ; top: 0.19em ; right: 2px }'
        + `.bravegpt footer a:hover { color: ${ scheme == 'dark' ? 'white' : 'black' } ; text-decoration: none }`
        + '@keyframes pulse { 0%, to { opacity: 1 } 50% { opacity: .5 }}'
        + '.balloon-tip { content: "" ; position: relative ; border: 7px solid transparent ;'
            + ( isChromium ? 'top: 0.16em ; right: 5.1rem;' : 'top: 0.25em ; right: 10.38rem ;' )
            + 'border-bottom-style: solid ; border-bottom-width: 16px ; border-top: 0 ; border-bottom-color:'
                + ( scheme == 'dark' ? '#3a3a3a' : '#eaeaea' ) + '}'
        + '.chatgpt-js { font-family: var(--brand-font) ; font-size: .65rem ; position: relative ; right: .9rem }'
        + '.chatgpt-js > a { color: inherit ; top: .054rem }'
        + '.chatgpt-js > svg { top: 3px ; position: relative ; margin-right: 1px }'
        + '.continue-chat > textarea {'
            + `border: solid 1px ${ scheme == 'dark' ? '#aaa' : '#638ed4' } ; border-radius: 12px 15px 12px 0 ;`
            + 'border-radius: 15px 16px 15px 0 ; margin: -6px 0 -7px 0 ;  padding: 14px 22px 5px 10px ;'
            + 'height: 2.15rem ; width: 100% ; max-height: 200px ; resize: none ; background:'
                + ( scheme == 'dark' ? '#515151' : '#eeeeee70' ) + '}'
        + '.related-queries { display: flex ; flex-wrap: wrap ; width: 100% ; margin-bottom: -18px ;'
            + 'position: relative ; top: -3px ;' // scooch up to hug feedback gap
            + ( isChromium ? 'margin-top: -31px' : '' ) + '}'
        + '.related-query { margin: 4px 4px 2px 0 ; padding: 8px 13px 7px 14px ;'
            + `color: ${ scheme == 'dark' ? '#f2f2f2' : '#767676' } ;`
            + `background: ${ scheme == 'dark' ? '#424242' : '#dadada12' } ;`
            + `border: 1px solid ${ scheme == 'dark' ? '#777' : '#e1e1e1' } ; font-size: 0.77em ; cursor: pointer ;`
            + 'border-radius: 0 13px 12px 13px ; width: fit-content ; flex: 0 0 auto ;'
            + `box-shadow: 1px 3px ${ scheme == 'dark' ? '11px -8px lightgray' : '8px -6px rgba(169, 169, 169, 0.75)' };`
            + 'transition: transform 0.1s ease !important ; transform: scale(1) }'
        + '.related-query:hover, .related-query:focus { transform: scale(1.025) !important ;'
            + `background: ${ scheme == 'dark' ? '#a2a2a270': '#e5edff ; color: #000000a8 ; border-color: #a3c9ff' }}`
        + '.related-query svg { float: left ; margin: 0.09em 6px 0 0 ;' // related query icon
            + `color: ${ scheme == 'dark' ? '#aaa' : '#c1c1c1' }}`
        + '.fade-in { opacity: 0 ; transform: translateY(7px) ; transition: opacity 0.5s ease, transform 0.5s ease }'
        + '.fade-in.active { opacity: 1 ; transform: translateY(0) }'
        + '#send-btn { border: none ; float: right ; position: relative ; background: none ; margin: 29px 4px 0 0 ;'
            + `color: ${ scheme == 'dark' ? '#aaa' : 'lightgrey' } ; cursor: pointer }`
        + `#send-btn:hover { color: ${ scheme == 'dark' ? 'white' : '#638ed4' } }`
        + '.kudo-ai { margin-left: 7px ; font-size: .65rem ; color: #aaa }'
        + '.kudo-ai a { color: #aaa ; text-decoration: none }'
        + `.kudo-ai a:hover { color: ${ scheme == 'dark' ? 'white' : 'black' } ; text-decoration: none }`
        + '.katex-html { display: none }' // hide unrendered math
        + '.chatgpt-modal > div { padding: 24px 20px 24px 20px !important }' // increase alert padding
        + '.chatgpt-modal p { margin-left: 4px ; font-size: 1.115rem }' // position/size alert msg
        + '.chatgpt-modal button {' // alert buttons
            + 'font-size: 0.72rem ; text-transform: uppercase ; min-width: 123px ; '
            + ( !isMobile ? 'padding: 5px !important ;' : '' )
            + 'border-radius: 0 !important ; border: 1px solid ' + ( scheme == 'dark' ? 'white' : 'black' ) + ' !important }'
        + `.modal-buttons { margin: 20px 0px -3px ${ isMobile ? 0 : -7 }px !important }` // position alert buttons
        + '.modal-close-btn { top: -7px }' // raise alert close button
        + ( scheme == 'dark' ? // darkmode alert styles
            ( '.chatgpt-modal > div, .chatgpt-modal button:not(.primary-modal-btn) {'
                + 'background-color: black !important ; color: white }'
            + '.primary-modal-btn { background: white !important ; color: black !important }'
            + '.modal-close-btn { stroke: white ; fill: white }'
            + '.chatgpt-modal a { color: #00cfff !important }' ) : '' )
        + ( // stylize scrollbars in Chromium/Safari
              '.bravegpt *::-webkit-scrollbar { width: 7px }'
            + '.bravegpt *::-webkit-scrollbar-thumb { background: #cdcdcd }'
            + '.bravegpt *::-webkit-scrollbar-thumb:hover { background: #a6a6a6 }'
            + '.bravegpt *::-webkit-scrollbar-track { background: none }' )
        + '.bravegpt * { scrollbar-width: thin }' // make scrollbars thin in Firefox
    )
    document.head.append(appStyle)

    // Create Brave Search style tweaks
    const tweaksStyle = document.createElement('style'),
          wsbStyles = 'main.main-column, aside.sidebar { max-width: 521px !important }'
                    + '.bravegpt { width: 521px }',
          ssbStyles = '.bravegpt { position: sticky ; top: 14px }'
                    + '.bravegpt ~ * { display: none }' // hide sidebar contents
                    + 'main > div:first-of-type { overflow: visible !important }'
    updateTweaksStyle() ; document.head.append(tweaksStyle)

    // Create/stylize tooltip div
    const tooltipDiv = document.createElement('div'),
          tooltipStyle = document.createElement('style')
    tooltipDiv.classList.add('button-tooltip', 'no-user-select')
    tooltipStyle.innerText = '.button-tooltip {'
        + 'background: black ; padding: 5px ; border-radius: 6px ; border: 1px solid #d9d9e3 ;' // bubble style
        + 'font-size: 0.55rem ; color: white ;' // font style
        + 'position: absolute ;' // for updateTooltip() calcs
        + 'opacity: 0 ; transition: opacity 0.1s ; height: fit-content ; z-index: 9999 }' // visibility
    document.head.append(tooltipStyle)

    // Create/classify BraveGPT container
    const appDiv = document.createElement('div') // create container div
    appDiv.classList.add('bravegpt', 'fade-in', // BraveGPT classes
                              'snippet') // Brave class

    // Append to Brave
    const hostContainer = document.querySelector(isMobile ? '#results' : '.sidebar')
    hostContainer.style.overflow = hostContainer.parentNode.style.overflow = 'visible' // for boundless hover fx
    setTimeout(() => {
        hostContainer.prepend(appDiv)
        setTimeout(() => appDiv.classList.add('active'), 100) // fade in
    }, isMobile ? 500 : 100)

    // Init footer CTA to share feedback
    let footerContent = createAnchor(config.feedbackURL, messages.link_shareFeedback || 'Feedback')
    footerContent.classList.add('feedback', 'svelte-8js1iq') // Brave classes

    // Show standby mode or get/show answer
    if (config.autoGetDisabled
        || config.prefixEnabled && !/.*q=%2F/.test(document.location) // prefix required but not present
        || config.suffixEnabled && !/.*q=.*%3F(&|$)/.test(document.location) // suffix required but not present
    ) { updateFooterContent() ; appShow('standby', footerContent) }
    else {
        appAlert('waitingResponse')
        const query = `${ new URL(location.href).searchParams.get('q') } (reply in ${ config.replyLanguage })`
        convo.push({ role: 'user', content: query })
        getShowReply(convo)
    }

})()
